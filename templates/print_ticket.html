<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phi·∫øu In - #{{ row.id }}</title>
    <style>
        /* C·∫•u h√¨nh chung */
        body {
            font-family: 'Arial', sans-serif;
            background: #e5e5e5;
            margin: 0;
            padding: 20px;
        }

        /* KHUNG PHI·∫æU (14cm - G√≥c tr√°i) */
        .ticket-container {
            background: #fff;
            width: 140mm; /* R·ªông 14cm */
            border: 2px dashed #000; /* Vi·ªÅn c·∫Øt */
            padding: 10px;
            box-sizing: border-box;
            position: relative;
        }

        .cut-icon {
            position: absolute;
            top: -12px; right: -10px;
            background: #fff; font-size: 16px;
        }

        .header {
            text-align: center; /* Ti√™u ƒë·ªÅ phi·∫øu th√¨ v·∫´n n√™n gi·ªØa cho ƒë·∫πp */
            border-bottom: 2px solid #000;
            padding-bottom: 5px; margin-bottom: 10px;
        }
        .header h2 { margin: 0; font-size: 18px; text-transform: uppercase; }
        .header p { margin: 2px 0 0; font-size: 11px; color: #333; }

        /* L∆Ø·ªöI 3 C·ªòT */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 c·ªôt chia ƒë·ªÅu kh√¥ng gian */
            gap: 5px; /* Kho·∫£ng c√°ch gi·ªØa c√°c √¥ */
            
            /* QUAN TR·ªåNG: D√≤ng n√†y gi√∫p √¥ ng·∫Øn kh√¥ng b·ªã k√©o d√†i theo √¥ cao */
            align-items: start; 
        }

        .item-box {
            border: 1px solid #ccc;
            padding: 5px;
            background: #fff;
            break-inside: avoid;
            
            /* CƒÇN CH·ªàNH TUY·ªÜT ƒê·ªêI V·ªÄ G√ìC TR√ÅI TR√äN */
            display: block; /* D√πng block th√¥ng th∆∞·ªùng ƒë·ªÉ tu√¢n th·ªß d√≤ng ch·∫£y vƒÉn b·∫£n */
            text-align: left; /* CƒÉn tr√°i */
            height: auto; /* Chi·ªÅu cao t·ª± ƒë·ªông theo d·ªØ li·ªáu */
        }

        .label {
            display: block;
            width: 100%;
            font-size: 9px;
            font-weight: bold;
            color: #555;
            text-transform: uppercase;
            border-bottom: 1px solid #eee; 
            margin-bottom: 4px;
            padding-bottom: 2px;
            text-align: left; /* Ch·∫Øc ch·∫Øn ti√™u ƒë·ªÅ c≈©ng cƒÉn tr√°i */
        }

        .value {
            display: block;
            font-size: 11px;
            font-weight: bold;
            color: #000;
            line-height: 1.3;
            width: 100%;
            text-align: left; /* Ch·∫Øc ch·∫Øn d·ªØ li·ªáu cƒÉn tr√°i */

            /* T·ª∞ ƒê·ªòNG XU·ªêNG D√íNG */
            white-space: pre-wrap; 
            word-wrap: break-word; 
            overflow-wrap: break-word;
        }

        .footer {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            font-style: italic;
        }

        /* N√∫t b·∫•m */
        .control-panel { margin-bottom: 20px; }
        .btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-right: 10px; }
        .btn-print { background: #2563eb; color: white; }
        .btn-close { background: #6b7280; color: white; }

        @media print {
            @page { size: A4; margin: 5mm; }
            body { background: white; padding: 0; margin: 0; }
            .control-panel { display: none; }
            .ticket-container { border: 2px dashed #000; }
        }
    </style>
</head>
<body>

    <div class="control-panel">
        <button onclick="window.print()" class="btn btn-print">üñ®Ô∏è IN NGAY</button>
        <button onclick="window.close()" class="btn btn-close">ƒê√ìNG</button>
    </div>

    <div class="ticket-container">
        <div class="cut-icon">‚úÇÔ∏è</div>
        
        <div class="header">
            <h2>PHI·∫æU TH√îNG TIN</h2>
            <p>ID: <b>#{{ row.id }}</b> | {{ today }}</p>
        </div>

        <div class="grid-container">
            {% for col in columns %}
            <div class="item-box">
                <span class="label">{{ col.name }}</span>
                <div class="value">
                    {% set val = row.content.get(col.name, '') %}
                    {% if val is iterable and val is not string %}
                        {{ val | join('<br>') | safe }}
                    {% else %}
                        {{ val }}
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="footer">
            <div>NV: {{ current_user.username }}</div>
            <div>X√°c nh·∫≠n: ....................</div>
        </div>
    </div>

    <script>
        window.onload = function() {
            setTimeout(function() { window.print(); }, 500);
        }
    </script>

</body>
</html>