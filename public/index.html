<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghichu App & Magic Edit</title> 
    <link rel="icon" href="/icons/icon-192x192.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1F2937">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Thêm Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-900 text-gray-100 antialiased">

    <header class="bg-gray-800 shadow-md sticky top-0 z-30">
        <nav class="container mx-auto px-4 py-4 relative">
             <!-- DESKTOP HEADER -->
             <div class="hidden sm:flex justify-between items-center">
                 <div class="flex space-x-2">
                     <button id="news-tab-btn" class="tab-button active text-xl font-bold !ml-0">Tin Tức</button>
                     <button id="calendar-tab-btn" class="tab-button text-xl font-bold">Lịch</button>
                     <button id="magic-tab-btn" class="tab-button text-xl font-bold text-orange-500">Sửa Ảnh AI</button>
                 </div>
                 
                 <div id="news-controls" class="flex items-center">
                    <div id="feed-nav" class="flex space-x-2 overflow-x-auto py-1">
                         <button class="feed-button active px-4 py-2 rounded-lg" data-rss="https://vnexpress.net/rss/tin-moi-nhat.rss" data-source="VnExpress">VnExpress</button>
                         <button class="feed-button px-4 py-2 rounded-lg" data-rss="https://dantri.com.vn/rss/home.rss" data-source="Dân Trí">Dân Trí</button>
                         <button id="refresh-feed-button" class="refresh-button" title="Tải lại"><i data-lucide="rotate-ccw" class="w-5 h-5"></i></button>
                    </div>
                 </div>
                 <button id="settings-btn" class="text-gray-400 hover:text-white p-2"><i data-lucide="settings" class="w-6 h-6"></i></button>
             </div>
             
             <!-- MOBILE HEADER -->
             <div class="sm:hidden flex justify-between items-center"> 
                 <span id="mobile-header-title" class="text-xl font-bold text-white truncate">Tin Tức</span>
                 <div class="flex items-center space-x-2 flex-shrink-0">
                     <button id="refresh-feed-button-mobile" class="refresh-button"><i data-lucide="rotate-ccw" class="w-5 h-5"></i></button>
                     <button id="rss-menu-btn" class="text-gray-300 p-2"><i data-lucide="menu" class="w-6 h-6"></i></button>
                 </div>
             </div>
             
             <!-- MOBILE RSS MENU -->
             <div id="rss-mobile-menu" class="hidden sm:hidden bg-gray-700 absolute top-full left-0 right-0 z-20 shadow-lg mt-1 rounded-b-md">
                 <div class="px-2 pt-2 pb-3 space-y-1">
                     <button class="feed-button active" data-rss="https://vnexpress.net/rss/tin-moi-nhat.rss" data-source="VnExpress">VnExpress</button>
                     <button class="feed-button" data-rss="https://dantri.com.vn/rss/home.rss" data-source="Dân Trí">Dân Trí</button>
                     <button class="feed-button" data-rss="https://thethao247.vn/bong-da.rss" data-source="Thể Thao 247">Thể Thao</button>
                 </div>
             </div>
        </nav>
    </header>

    <!-- TAB TIN TỨC -->
    <main id="news-main" class="container mx-auto p-4 md:p-8">
        <div id="loading-spinner" class="flex justify-center items-center h-64">
            <div class="spinner border-t-blue-500" style="width: 50px; height: 50px;"></div>
        </div>
        <div id="news-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </main>
    
    <!-- TAB LỊCH -->
    <main id="calendar-main" class="container mx-auto p-4 md:p-6 max-w-4xl hidden">
        <div class="mb-4 bg-gray-800 rounded-lg p-1 flex space-x-1">
            <button id="cal-subtab-work" class="sub-tab-button active">Lịch Làm Việc</button>
            <button id="cal-subtab-reminders" class="sub-tab-button">Nhắc Nhở</button>
        </div>
        <div id="calendar-work-content">
            <section id="calendar-container" class="bg-white text-gray-900 rounded-lg shadow-lg p-4 md:p-6">
                <div id="calendar-header" class="flex justify-between items-center mb-4">
                    <button id="prev-month-btn" class="p-2"><i data-lucide="chevron-left" class="text-gray-600"></i></button>
                    <h2 id="current-month-year" class="text-xl font-bold">Tháng -- ----</h2>
                    <button id="next-month-btn" class="p-2"><i data-lucide="chevron-right" class="text-gray-600"></i></button>
                </div>
                <div class="overflow-x-auto"><div id="calendar-body" class="grid grid-cols-7 gap-1 md:gap-2"></div></div>
            </section>
            <section id="monthly-note-summary" class="bg-gray-800 rounded-lg shadow-lg p-4 mt-6">
                <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-white">Tổng kết</h2></div>
                <div id="monthly-note-list" class="space-y-3"></div>
            </section>
            <button id="fab-ai-toggle" class="fab-btn"><i data-lucide="sparkles"></i></button>
        </div>
        <div id="calendar-reminders-content" class="hidden">
            <div id="reminder-list-container" class="space-y-6"></div>
            <button id="fab-reminder-toggle" class="fab-btn"><i data-lucide="plus"></i></button>
        </div>
    </main>

    <!-- (MỚI) TAB MAGIC EDIT (SỬA ẢNH) -->
    <main id="magic-main" class="container mx-auto p-4 md:p-6 hidden h-[calc(100vh-140px)]">
        <div class="flex flex-col md:flex-row gap-4 h-full">
            <!-- SIDEBAR CÔNG CỤ -->
            <aside class="w-full md:w-80 bg-gray-800 rounded-xl p-4 flex flex-col overflow-y-auto">
                <div class="mb-6">
                    <h3 class="text-sm font-semibold text-gray-400 mb-3">1. ẢNH GỐC</h3>
                    <div id="upload-zone" class="border-2 border-dashed border-gray-600 rounded-xl p-4 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-700 h-40 relative">
                        <input type="file" id="image-upload-input" class="hidden" accept="image/*">
                        <div id="upload-placeholder" class="text-center">
                            <i data-lucide="upload-cloud" class="w-8 h-8 mx-auto mb-2 text-gray-500"></i>
                            <p class="text-sm text-gray-300">Nhấn để tải ảnh</p>
                        </div>
                        <img id="preview-img-sidebar" class="absolute inset-0 w-full h-full object-contain rounded-xl hidden bg-black/50">
                    </div>
                </div>

                <div class="flex-1">
                    <h3 class="text-sm font-semibold text-gray-400 mb-3">2. CÔNG CỤ AI</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <button class="magic-tool-btn" data-prompt="Làm nét ảnh, tăng độ phân giải, khử nhiễu (Upscale & Denoise).">
                            <i data-lucide="wand-2" class="mb-1 text-orange-500"></i>
                            <span>Phục hồi</span>
                        </button>
                        <button class="magic-tool-btn" data-prompt="Tách nền chủ thể, thay thế bằng nền trắng tinh khiết.">
                            <i data-lucide="scissors" class="mb-1 text-blue-500"></i>
                            <span>Tách nền</span>
                        </button>
                        <button class="magic-tool-btn" data-prompt="Chuyển thành ảnh thẻ 3x4 phông nền xanh dương chuẩn quốc tế.">
                            <i data-lucide="camera" class="mb-1 text-green-500"></i>
                            <span>Ảnh thẻ</span>
                        </button>
                        <button class="magic-tool-btn" data-prompt="Xóa text, watermark và các vật thể thừa trên ảnh.">
                            <i data-lucide="eraser" class="mb-1 text-red-500"></i>
                            <span>Xóa Vật thể</span>
                        </button>
                        <button class="magic-tool-btn" data-prompt="Thay trang phục nhân vật thành bộ Vest công sở chuyên nghiệp.">
                            <i data-lucide="shirt" class="mb-1 text-purple-500"></i>
                            <span>Thay Vest</span>
                        </button>
                        <button class="magic-tool-btn" data-prompt="Phân tích chi tiết bức ảnh này xem có gì.">
                            <i data-lucide="scan-eye" class="mb-1 text-yellow-500"></i>
                            <span>Phân tích</span>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- KHUNG HIỂN THỊ (CANVAS) -->
            <section class="flex-1 bg-black/30 rounded-xl border border-gray-700 relative flex items-center justify-center overflow-hidden p-4">
                <div id="empty-state-canvas" class="text-center text-gray-500">
                    <i data-lucide="image" class="w-16 h-16 mx-auto mb-2 opacity-50"></i>
                    <p>Không gian làm việc</p>
                </div>
                
                <img id="main-canvas-img" class="max-w-full max-h-full object-contain shadow-2xl rounded hidden">
                
                <!-- Loading Overlay -->
                <div id="magic-loading" class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-20 hidden">
                    <div class="spinner border-t-orange-500 mb-4"></div>
                    <p class="text-orange-500 animate-pulse">AI đang xử lý...</p>
                </div>

                <!-- Result Text Overlay (Vì 2.5 Flash trả text là chính) -->
                <div id="magic-result-text" class="absolute bottom-0 left-0 right-0 bg-gray-900/90 p-4 text-sm text-white max-h-[50%] overflow-y-auto hidden border-t border-orange-500">
                    <h4 class="font-bold text-orange-400 mb-1">Kết quả AI:</h4>
                    <p id="magic-result-content"></p>
                    <button id="close-result-text" class="absolute top-2 right-2 text-gray-400 hover:text-white"><i data-lucide="x"></i></button>
                </div>
            </section>
        </div>
    </main>

    <!-- TAB LƯU TRỮ -->
    <main id="links-main" class="container mx-auto p-4 hidden">
        <h2 class="text-xl font-bold text-white mb-4">Danh sách đã lưu</h2>
        <div id="link-list-container" class="space-y-3"></div>
        <button id="fab-link-toggle" class="fab-btn"><i data-lucide="plus"></i></button>
    </main>
    
    <!-- TAB CÀI ĐẶT -->
    <main id="settings-main" class="container mx-auto p-4 hidden">
        <div class="bg-gray-800 p-6 rounded-lg max-w-md mx-auto">
            <h2 class="text-2xl font-bold text-white mb-6">Cài đặt</h2>
            <button id="notify-button" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg mb-4">Bật Thông Báo</button>
            <div class="space-y-3">
                <input type="text" id="sync-username" placeholder="Tên đồng bộ" class="w-full p-3 rounded bg-gray-700 text-white">
                <input type="password" id="sync-password" placeholder="Mật khẩu" class="w-full p-3 rounded bg-gray-700 text-white">
                <div class="flex space-x-2">
                    <button id="sync-up-btn" class="flex-1 bg-blue-600 py-2 rounded text-white">Tải lên</button>
                    <button id="sync-down-btn" class="flex-1 bg-green-600 py-2 rounded text-white">Tải về</button>
                </div>
            </div>
        </div>
    </main>

    <!-- CÁC MODAL (GIỮ NGUYÊN NHƯ CŨ, CHỈ RÚT GỌN ĐỂ HIỂN THỊ) -->
    <div id="ai-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
            <h2 class="text-xl text-white mb-4">Thêm Nhanh AI</h2>
            <form id="ai-form"><input id="ai-input" class="w-full p-3 bg-gray-700 text-white rounded mb-4" placeholder="Ví dụ: Họp 9h sáng mai..."><button class="w-full bg-blue-600 text-white p-3 rounded">Phân tích</button></form>
            <button id="close-ai-modal" class="mt-4 text-gray-400 w-full">Đóng</button>
        </div>
    </div>
    
    <div id="note-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md">
             <h2 id="note-modal-title" class="text-xl text-white mb-2">Ghi chú</h2>
             <p id="modal-shift-info" class="text-gray-400 mb-4"></p>
             <ul id="note-list" class="mb-4 space-y-2"></ul>
             <form id="add-note-form" class="flex gap-2"><input id="new-note-input" class="flex-1 bg-gray-700 text-white p-2 rounded"><button class="bg-blue-600 text-white px-4 rounded">Thêm</button></form>
             <button id="close-note-modal" class="mt-4 w-full text-gray-400">Đóng</button>
        </div>
    </div>

    <!-- BOTTOM NAVIGATION (MOBILE) -->
    <nav id="bottom-nav" class="sm:hidden">
        <button id="bottom-tab-news" class="bottom-nav-btn active"><i data-lucide="newspaper"></i><span>Tin</span></button>
        <button id="bottom-tab-calendar" class="bottom-nav-btn"><i data-lucide="calendar"></i><span>Lịch</span></button>
        <!-- NÚT MỚI: MAGIC EDIT MOBILE -->
        <button id="bottom-tab-magic" class="bottom-nav-btn text-orange-500"><i data-lucide="wand-2"></i><span>Sửa Ảnh</span></button>
        <button id="bottom-tab-links" class="bottom-nav-btn"><i data-lucide="archive"></i><span>Kho</span></button>
        <button id="bottom-tab-settings" class="bottom-nav-btn"><i data-lucide="settings"></i><span>Cài đặt</span></button>
    </nav>
    
    <script type="module" src="/app.js"></script>
    <script>
        // Khởi tạo Icons
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
</body>
</html>

